<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:GestaoChamadosAI_MAUI.ViewModels"
             xmlns:models="clr-namespace:GestaoChamadosAI_MAUI.Models"
             xmlns:behaviors="clr-namespace:GestaoChamadosAI_MAUI.Behaviors"
             x:Class="GestaoChamadosAI_MAUI.Views.RelatorioSuportesPage"
             x:DataType="vm:RelatorioSuportesViewModel"
             Title="RelatÃ³rio de Suportes">

    <Grid RowDefinitions="Auto,Auto,Auto,*" Padding="0,0,0,10">
        
        <!-- Logo + Barra de AÃ§Ãµes -->
        <Grid Grid.Row="0" BackgroundColor="{StaticResource Primary}" Padding="15" ColumnDefinitions="Auto,*,Auto">
            <Image Grid.Column="0" Source="logo.png" WidthRequest="35" HeightRequest="35" HorizontalOptions="Start" VerticalOptions="Center"/>
            
            <HorizontalStackLayout Grid.Column="2" Spacing="10">
                <Button Text="â† Voltar"
                        Command="{Binding VoltarCommand}"
                        HeightRequest="45"
                        WidthRequest="110"
                        FontSize="14"
                        BackgroundColor="{StaticResource Gray700}"
                        TextColor="White"
                        CornerRadius="8"
                        Padding="5,0"/>
                <Button Text="ðŸ“„ PDF"
                        Command="{Binding ImprimirPDFCommand}"
                        HeightRequest="45"
                        FontSize="14"
                        BackgroundColor="#dc3545"
                        TextColor="White"
                        WidthRequest="90"
                        CornerRadius="8"
                        Padding="5,0"/>
            </HorizontalStackLayout>
        </Grid>
        
        <!-- Header -->
        <Frame Grid.Row="2" 
               BackgroundColor="White" 
               CornerRadius="12" 
               Padding="20" 
               HasShadow="True"
               Margin="10,10,10,10">
            <HorizontalStackLayout Spacing="15">
                <Label Text="ðŸ‘¥" FontSize="32" VerticalOptions="Center"/>
                <VerticalStackLayout>
                    <Label Text="RelatÃ³rio de Suportes" 
                           FontSize="20" 
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"/>
                    <Label Text="{Binding TotalSuportes, StringFormat='Total: {0} suportes'}" 
                           FontSize="14" 
                           TextColor="{StaticResource Gray600}"/>
                </VerticalStackLayout>
            </HorizontalStackLayout>
        </Frame>

        <!-- Lista de Suportes -->
        <ScrollView Grid.Row="3">
            <CollectionView ItemsSource="{Binding Suportes}" IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:SuporteDetalhado">
                        <Frame Margin="0,0,0,10" 
                               Padding="20" 
                               BackgroundColor="White" 
                               CornerRadius="12" 
                               HasShadow="True">
                            <VerticalStackLayout Spacing="15">
                                
                                <!-- InformaÃ§Ãµes do Suporte -->
                                <Grid ColumnDefinitions="Auto,*">
                                    <Frame Grid.Column="0" 
                                           WidthRequest="60" 
                                           HeightRequest="60" 
                                           CornerRadius="30" 
                                           Padding="0" 
                                           BackgroundColor="{StaticResource Primary}"
                                           HasShadow="False">
                                        <Label Text="ðŸ‘¤" 
                                               FontSize="32" 
                                               HorizontalOptions="Center" 
                                               VerticalOptions="Center"/>
                                    </Frame>

                                    <VerticalStackLayout Grid.Column="1" Spacing="5" VerticalOptions="Center">
                                        <Label Text="{Binding Nome}" 
                                               FontSize="18" 
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Gray900}"/>
                                        <Label Text="{Binding Email}" 
                                               FontSize="14" 
                                               TextColor="{StaticResource Gray600}"/>
                                        <Label Text="{Binding DataCadastro, StringFormat='Desde: {0:dd/MM/yyyy}'}" 
                                               FontSize="12" 
                                               TextColor="{StaticResource Gray500}"/>
                                    </VerticalStackLayout>
                                </Grid>

                                <!-- EstatÃ­sticas de Chamados -->
                                <BoxView HeightRequest="1" BackgroundColor="{StaticResource Gray200}"/>

                                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                                    <Grid.Behaviors>
                                        <behaviors:ResponsiveGridBehavior Columns="3"/>
                                    </Grid.Behaviors>
                                    <!-- Total -->
                                    <Frame Grid.Column="0" 
                                           BackgroundColor="{StaticResource Gray100}" 
                                           Padding="12,10" 
                                           CornerRadius="8"
                                           HasShadow="False">
                                        <VerticalStackLayout>
                                            <Label Text="Total" 
                                                   FontSize="11" 
                                                   TextColor="{StaticResource Gray600}"
                                                   HorizontalOptions="Center"
                                                   LineBreakMode="NoWrap"/>
                                            <Label Text="{Binding TotalChamados}" 
                                                   FontSize="20" 
                                                   FontAttributes="Bold" 
                                                   TextColor="{StaticResource Primary}"
                                                   HorizontalOptions="Center"/>
                                        </VerticalStackLayout>
                                    </Frame>

                                    <!-- Ativos -->
                                    <Frame Grid.Column="1" 
                                           BackgroundColor="#DBEAFE" 
                                           Padding="12,10" 
                                           CornerRadius="8"
                                           HasShadow="False">
                                        <VerticalStackLayout>
                                            <Label Text="Ativos" 
                                                   FontSize="11" 
                                                   TextColor="#1E3A8A"
                                                   HorizontalOptions="Center"
                                                   LineBreakMode="NoWrap"/>
                                            <Label Text="{Binding ChamadosAtivos}" 
                                                   FontSize="20" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#2563EB"
                                                   HorizontalOptions="Center"/>
                                        </VerticalStackLayout>
                                    </Frame>

                                    <!-- Finalizados -->
                                    <Frame Grid.Column="2" 
                                           BackgroundColor="#D1FAE5" 
                                           Padding="12,10" 
                                           CornerRadius="8"
                                           HasShadow="False">
                                        <VerticalStackLayout>
                                            <Label Text="Finalizados" 
                                                   FontSize="11" 
                                                   TextColor="#065F46"
                                                   HorizontalOptions="Center"
                                                   LineBreakMode="WordWrap"
                                                   MaxLines="2"
                                                   HorizontalTextAlignment="Center"/>
                                            <Label Text="{Binding ChamadosFinalizados}" 
                                                   FontSize="20" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#059669"
                                                   HorizontalOptions="Center"/>
                                        </VerticalStackLayout>
                                    </Frame>
                                </Grid>

                                <!-- Por Prioridade -->
                                <VerticalStackLayout Spacing="8" IsVisible="{Binding ChamadosPorPrioridade.Count}">
                                    <Label Text="Por Prioridade:" 
                                           FontSize="14" 
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Gray700}"/>
                                    
                                    <CollectionView ItemsSource="{Binding ChamadosPorPrioridade}">
                                        <CollectionView.ItemTemplate>
                                            <DataTemplate x:DataType="models:PrioridadeCount">
                                                <Grid ColumnDefinitions="*,Auto" Padding="5,2">
                                                    <Label Grid.Column="0" 
                                                           Text="{Binding Prioridade}" 
                                                           FontSize="14" 
                                                           TextColor="{StaticResource Gray700}"
                                                           VerticalOptions="Center"/>
                                                    <Frame Grid.Column="1" 
                                                           BackgroundColor="{StaticResource Secondary}" 
                                                           Padding="8,4" 
                                                           CornerRadius="5" 
                                                           HasShadow="False">
                                                        <Label Text="{Binding Total}" 
                                                               FontSize="12" 
                                                               FontAttributes="Bold" 
                                                               TextColor="White"/>
                                                    </Frame>
                                                </Grid>
                                            </DataTemplate>
                                        </CollectionView.ItemTemplate>
                                    </CollectionView>
                                </VerticalStackLayout>

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="1" 
                          IsRunning="{Binding IsLoading}" 
                          IsVisible="{Binding IsLoading}"
                          Color="{StaticResource Primary}"
                          VerticalOptions="Center"
                          HorizontalOptions="Center"/>
    </Grid>
</ContentPage>
